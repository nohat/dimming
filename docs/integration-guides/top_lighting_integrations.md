# Top Lighting System Integrations

Okay, this is a deep dive into the practicalities of integrating our new universal lighting control. To do this effectively, I'll identify some of the most popular lighting integrations and then analyze them based on their underlying protocols and existing capabilities.

Keep in mind that "top 10 integrations" can be subjective and vary slightly in popularity, but I'll select a representative mix covering different communication methods (Wi-Fi, Zigbee, Z-Wave, cloud-based).

Here's the research and analysis:

______________________________________________________________________

## Research: Top 10 Home Assistant Lighting Integrations & Required Changes

This section surveys a selection of prominent Home Assistant lighting integrations and details the necessary changes to support the new `dynamic_control` API and related enhancements as completely and optimally as possible.

### General Assumptions for Analysis

- **HA Core Handles Curves:** For most integrations, the `curve` parameter within `dynamic_control` will be processed by Home Assistant Core's `LightTransitionManager`. Integrations will primarily send linear `brightness` values.
- **`_SIMULATED` Flags:** Unless explicitly supporting native `TRANSITION` or `DYNAMIC_CONTROL`, dimmable light integrations _should_ declare `LightEntityFeature.TRANSITION_SIMULATED` and `LightEntityFeature.DYNAMIC_CONTROL_SIMULATED` to enable Home Assistant Core's simulation capabilities for a consistent user experience.
- **`dynamic_state` Reporting:** Integrations should aim to provide granular `dynamic_state` where possible (e.g., from native `Move`/`Stop` commands or rapid changes). If not natively available, HA Core's simulation will manage this state for simulated effects.

______________________________________________________________________

### Integration Survey & Required Changes

| Rank   | Integration                      | Protocol/Type                   | Current `LightEntityFeature` Flags (Typical)                                | Native Transition Support (`transition:` param)                                                                                           | Native Continuous Control (`move`/`stop`)                                                                                                         | Native Dimming Curve Support                                                                                                 | Required Changes for New API                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| :----- | :------------------------------- | :------------------------------ | :-------------------------------------------------------------------------- | :---------------------------------------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------ | :--------------------------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **1**  | **ZHA (Zigbee Home Automation)** | Zigbee (Local)                  | `BRIGHTNESS`, `COLOR_TEMP`, `COLOR`, \`\`TRANSITION\`(depending on device)  | **Varies by device/firmware.** Many modern bulbs support`Move to Level with On/Off\` (Level Control Cluster). Older/cheaper ones may not. | **Yes, for compatible devices.** Zigbee Level Control Cluster has \`Move\`, \`Stop\`, \`Step\` commands. ZHA often wraps these or could.          | **Rare/Device-Specific:** Not a standard dynamic command. Some devices may have configurable internal parameters via quirks. | **High:**\<br>1. **Declare \`DYNAMIC_CONTROL\`:** If device exposes Level Control \`Move\`/\`Stop\`/\`Step\` via \`zigpy\`.\<br>2. **Map \`dynamic_control\`:** Translate to Zigbee Level Control \`Move\`/\`Stop\`/\`Step\` commands.\<br>3. **Report \`dynamic_state\`:** Infer from commands sent/received Level Control cluster reports.\<br>4. **\`\_SIMULATED\` Fallback:** Always declare \`TRANSITION_SIMULATED\` and \`DYNAMIC_CONTROL_SIMULATED\` for dimmable lights for HA Core fallback.\<br>5. **Controller Event \`event_data\`:** For Zigbee remotes, standardize \`event_data\` for \`zha_event\` triggers.                                                                                                                                  |
| **2**  | **Z-Wave JS**                    | Z-Wave (Local)                  | \`BRIGHTNESS\`, \`COLOR_TEMP\`, \`COLOR\`, \`TRANSITION\` (often supported) | **Yes, often supported.** \`Multilevel Switch Set\` command includes a \`duration\` parameter.                                            | **Yes, for compatible devices.** \`Multilevel Switch Command Class\` has \`Start Level Change\` and \`Stop Level Change\` commands.               | **Rare/Device-Specific:** Not a standard dynamic command. Some devices have configurable parameters.                         | **High:**\<br>1. **Declare \`DYNAMIC_CONTROL\`:** If device exposes \`Multilevel Switch Start/Stop Level Change\`.\<br>2. **Map \`dynamic_control\`:** Translate to Z-Wave \`Multilevel Switch Start/Stop Level Change\` commands.\<br>3. **Report \`dynamic_state\`:** Infer from commands sent/received value notifications.\<br>4. **\`\_SIMULATED\` Fallback:** Always declare \`TRANSITION_SIMULATED\` and \`DYNAMIC_CONTROL_SIMULATED\` for dimmable lights.\<br>5. **Controller Event \`event_data\`:** For Z-Wave remotes/dimmers, standardize \`event_data\` for \`zwave_js_value_updated\` or \`zwave_js_event\` triggers.                                                                                                                          |
| **3**  | **Philips Hue**                  | Hue Bridge (Local API)          | \`BRIGHTNESS\`, \`COLOR_TEMP\`, \`COLOR\`, \`EFFECT\`, \`TRANSITION\`       | **Excellent native support.** Hue Bridge handles transitions on the bridge, offloading devices.                                           | **Limited/Proprietary:** Hue doesn't expose a direct \`move\`/\`stop\` API command from the bridge. Their dimmers work via direct Zigbee binding. | **No:** Bridge handles.                                                                                                      | **Medium:**\<br>1. **\`\_SIMULATED\` for \`DYNAMIC_CONTROL\`:** Declare \`DYNAMIC_CONTROL_SIMULATED\` for all dimmable Hue lights. (HA Core will simulate \`move\`/\`stop\`).\<br>2. **Controller Event \`event_data\`:** Standardize \`event_data\` for Hue remotes (\`hue_event\`).\<br>3. **Potentially advanced:** Research if Hue Bridge offers _any_ hidden APIs for continuous control that could be exposed.                                                                                                                                                                                                                                                                                                                                          |
| **4**  | **ESPHome**                      | ESPHome API (Local)             | \`BRIGHTNESS\`, \`COLOR_TEMP\`, \`COLOR\`, \`EFFECT\`, \`TRANSITION\`       | **Good, implemented in firmware.** Configurable.                                                                                          | **Not yet (target of project).** Will be native after ESPHome Phase 2.                                                                            | **Not yet (target of project).** Will be configurable via YAML.                                                              | **High (Already part of the plan!):**\<br>1. **Phase 1 & 2:** Implement native \`DYNAMIC_CONTROL\` in firmware and expose via API.\<br>2. **Phase 3.4:** HA ESPHome integration declares \`DYNAMIC_CONTROL\` if new firmware is detected, and \`\_SIMULATED\` for all.\<br>3. **Report \`dynamic_state\`:** Directly consume from ESPHome API (Phase 2.4).\<br>4. **Controller Event \`event_data\`:** Standardize for ESPHome-based physical controls (buttons, rotary encoders).                                                                                                                                                                                                                                                                            |
| **5**  | **Tuya**                         | Cloud/Local (Tuya IoT Platform) | \`BRIGHTNESS\`, \`COLOR_TEMP\`, \`COLOR\`, \`EFFECT\`                       | **Inconsistent/Poor.** Often snaps. \`transition\` parameter typically ignored by cloud API or device firmware.                           | **No.** Requires rapid discrete commands.                                                                                                         | **No.**                                                                                                                      | **High:**\<br>1. **\`\_SIMULATED\` Flags:** Declare \`TRANSITION_SIMULATED\` and \`DYNAMIC_CONTROL_SIMULATED\` for all dimmable Tuya lights.\<br>2. **Reliance on HA Core:** Fully rely on HA Core's \`LightTransitionManager\` for smooth transitions and \`move\`/\`stop\` simulation.\<br>3. **Controller Event \`event_data\`:** Standardize \`event_data\` for Tuya-based remotes/switches (if they expose events).                                                                                                                                                                                                                                                                                                                                      |
| **6**  | **Yeelight**                     | Yeelight API (Local)            | \`BRIGHTNESS\`, \`COLOR_TEMP\`, \`COLOR\`, \`EFFECT\`, \`TRANSITION\`       | **Good.** Yeelight devices generally handle transitions natively.                                                                         | **Limited/No direct \`move\`/\`stop\`.** API allows setting brightness over a duration.                                                           | **No.**                                                                                                                      | **Medium:**\<br>1. **\`\_SIMULATED\` for \`DYNAMIC_CONTROL\`:** Declare \`DYNAMIC_CONTROL_SIMULATED\` as native \`move\`/\`stop\` commands are not directly available. (HA Core will simulate).\<br>2. **Controller Event \`event_data\`:** If Yeelight has physical remotes, standardize their events.                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| **7**  | **LIFX**                         | LIFX LAN Protocol (Local)       | \`BRIGHTNESS\`, \`COLOR_TEMP\`, \`COLOR\`, \`EFFECT\`, \`TRANSITION\`       | **Excellent native support.** Devices handle transitions very smoothly.                                                                   | **Limited/No direct \`move\`/\`stop\`.** API allows setting brightness over a duration.                                                           | **No.**                                                                                                                      | **Medium:**\<br>1. **\`\_SIMULATED\` for \`DYNAMIC_CONTROL\`:** Declare \`DYNAMIC_CONTROL_SIMULATED\` as native \`move\`/\`stop\` commands are not directly available. (HA Core will simulate).\<br>2. **Controller Event \`event_data\`:** If LIFX offers physical remotes/controls, standardize their events.                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| **8**  | **Tasmota (MQTT)**               | MQTT (Local)                    | \`BRIGHTNESS\`, \`COLOR_TEMP\`, \`COLOR\`, \`EFFECT\`                       | **Inconsistent.** \`Fade\` parameter exists but reliability varies by firmware/device. Often needs \`SetOption114 1\`.                    | **Yes, with \`Dimmer +/-\`, \`Dimmer !\` commands.** Tasmota provides commands for incremental/continuous dimming.                                | **Yes, via \`DimmerRange\` and \`Gamma\` settings.** Device-specific parameter.                                              | **High:**\<br>1. **Declare \`DYNAMIC_CONTROL\`:** If Tasmota device uses \`SetOption114 1\` and exposes \`Dimmer +/-, Dimmer !\` commands via MQTT. (Requires mapping).\<br>2. **Map \`dynamic_control\`:** Translate \`move\`/\`stop\` to Tasmota's \`Dimmer +/-\` and \`Dimmer !\` MQTT commands.\<br>3. **Report \`dynamic_state\`:** Infer from \`POWER\`/\`Dimmer\` state changes or directly from Tasmota telemetry.\<br>4. **\`\_SIMULATED\` Fallback:** Always declare \`TRANSITION_SIMULATED\` for dimmable Tasmota lights. (Some versions of Tasmota are less reliable with \`Fade\`).\<br>5. **Controller Event \`event_data\`:** Standardize \`event_data\` for Tasmota-based button/rotary controllers (using \`Button\` or \`Encoder\` topics). |
| **9**  | **SmartThings**                  | SmartThings Cloud API           | \`BRIGHTNESS\`, \`COLOR_TEMP\`, \`COLOR\`, \`EFFECT\`, \`TRANSITION\`       | **Varies by underlying device.** Cloud API passes requests; device dictates actual behavior. Often poor transitions.                      | **No.** Cloud API doesn't expose general \`move\`/\`stop\`.                                                                                       | **No.**                                                                                                                      | **High:**\<br>1. **\`\_SIMULATED\` Flags:** Declare \`TRANSITION_SIMULATED\` and \`DYNAMIC_CONTROL_SIMULATED\` for all dimmable SmartThings lights.\<br>2. **Reliance on HA Core:** Fully rely on HA Core's \`LightTransitionManager\` for smooth transitions and \`move\`/\`stop\` simulation.\<br>3. **Controller Event \`event_data\`:** Standardize \`event_data\` for SmartThings-connected remotes/buttons (via \`smartthings_webhook\` events).                                                                                                                                                                                                                                                                                                        |
| **10** | **HomeKit Controller**           | Apple HomeKit (Local)           | \`BRIGHTNESS\`, \`COLOR_TEMP\`, \`COLOR\`, \`EFFECT\`                       | **Generally good.** HomeKit's underlying protocol often handles transitions well.                                                         | **Limited/No direct \`move\`/\`stop\`.** Depends on how HomeKit accessories expose it.                                                            | **No.**                                                                                                                      | **Medium:**\<br>1. **\`\_SIMULATED\` for \`DYNAMIC_CONTROL\`:** Declare \`DYNAMIC_CONTROL_SIMULATED\` for all dimmable HomeKit lights.\<br>2. **Controller Event \`event_data\`:** If HomeKit exposes physical remotes, standardize their events.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |

______________________________________________________________________

### Key Takeaways for Implementation Strategy

1. **HA Core is the Universal Translator/Simulator:** For many popular integrations (Tuya, SmartThings, HomeKit, Yeelight, LIFX, and some ZHA/Z-Wave devices), Home Assistant Core's `LightTransitionManager` will be the workhorse for `dynamic_control` and smooth `transition` parameters. This offloads the complexity from individual integrations and ensures a consistent user experience. This means the `_SIMULATED` flags are critically important.

2. **Native Control for ZHA/Z-Wave/ESPHome is a Priority:** For integrations with strong local control and detailed protocol support (ZHA, Z-Wave JS, ESPHome), directly mapping to native `Move`/`Stop`/`Step` commands is paramount. This provides superior responsiveness and reduces network load.

3. **Standardizing Controller Events is Foundational:** The success of the "Control Mapping" UI hinges on all controller integrations emitting **standardized `event` entities with consistent `event_data` schemas (Phase 5, PR 5.1).** This is a universal prerequisite for intelligent pairing regardless of the light integration.

4. **Dimming Curves are HA Core's Domain:** The `curve` parameter will almost exclusively be handled by Home Assistant Core. Integrations will simply receive the pre-calculated, linear brightness values and pass them to the device. Device-specific _static_ curve configurations (like in Tasmota via `DimmerRange`) would remain device parameters, but not directly tied to the `dynamic_control` service call.

5. **Iterative Integration Updates:** Updates for each integration will likely be separate PRs, ensuring a modular and manageable rollout. Prioritize the integrations that support native dynamic control (`DYNAMIC_CONTROL`) first (ESPHome, ZHA, Z-Wave JS) to demonstrate optimal performance. Then, ensure the `_SIMULATED` flags are properly declared for all others.

This detailed breakdown confirms that our multi-phase approach, with Home Assistant Core as the central orchestrator and simulator, is the most robust way to achieve universal, high-quality lighting control.
